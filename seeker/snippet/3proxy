#date: 2024-05-30T17:09:46Z
#url: https://api.github.com/gists/38465b4dc9566695fb290abfae7a45b5
#owner: https://api.github.com/users/DiamondGlaz777

#!/bin/bash
red='\033[0;31m'
green='\033[0;32m'
yellow='\033[0;33m'
blue='\033[0;34m'
fuls='\033[0;45m'
plain='\033[0m'
echo -e "${red}Создатель: ${green} t.me/DiamondGlaz${plain}"
[[ $EUID -ne 0 ]] && echo -e "${red}Ошибка: ${plain} Пожалуйста запустите от имени ROOT.Зайти в root: su " && exit 1
start() {
iptables -F
iptables -I INPUT 1 -j ACCEPT
iptables -I OUTPUT 1 -j ACCEPT
iptables -I FORWARD 1 -j ACCEPT
/sbin/iptables-save
apt-get install build-essential -y
wget https://github.com/z3APA3A/3proxy/archive/0.9.3.tar.gz && tar xzf 0.9.3.tar.gz
cd 3proxy-*
make -f Makefile.Linux
apt-get remove build-essential -y
adduser --system --disabled-login --no-create-home --group proxy3
mkdir -p /var/log/3proxy /etc/3proxy
cp bin/3proxy /usr/bin/
chown proxy3:proxy3 -R /etc/3proxy /usr/bin/3proxy /var/log/3proxy
touch /etc/3proxy/3proxy.cfg
GGU=$(id proxy3 | grep uid | awk -F "=" '{print $2}' |rev|cut -c 13-|rev)
UUI=$(id proxy3 | grep uid | awk -F "=" '{print $3}' |rev|cut -c 16-|rev)
ip_address=$(wget -qO- eth0.me | awk '{print $1}')
  cat << EOF > /etc/3proxy/3proxy.cfg
setgid $GGU
setuid $UUI

nserver 1.1.1.1
nserver 1.0.0.1

nscache 65536
timeouts 1 5 30 60 180 1800 15 60

external $ip_address
internal $ip_address

daemon

log /var/log/3proxy/3proxy.log D
logformat "- +_L%t.%. %N.%p %E %U %C:%c %R:%r %O %I %h %T"
rotate 30

users user:CL:user1
auth strong
socks -n -p7777 -a
proxy -n -p8888

allow * * * 80-88,8080-8088 HTTP
allow * * * 443,8443 HTTPS
EOF

touch /etc/systemd/system/3proxy.service
  cat << EOF > /etc/systemd/system/3proxy.service
[Unit]
Description=Proxy Server

[Service]
User=proxy3
Group=proxy3
Type=simple
ExecStart=/usr/bin/3proxy /etc/3proxy/3proxy.cfg
ExecStop=/bin/kill `/usr/bin/pgrep -u proxy3`
RemainAfterExit=yes
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF
systemctl daemon-reload
systemctl enable 3proxy
systemctl start 3proxy
} &>/dev/null
start
echo -e "${yellow}Логин/Пароль SOCKS: ${green} user/user1 ${plain}"
echo -e "${yellow}IP:Порт SOCKS: ${green} $ip_address:7777 ${plain}"
echo -e "${yellow}HTTP Прокси без авторизации: ${green} $ip_address:8888 ${plain}"


