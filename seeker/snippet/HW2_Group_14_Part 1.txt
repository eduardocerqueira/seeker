#date: 2026-02-24T17:45:49Z
#url: https://api.github.com/gists/80dc2c79d34a148febfabbac7ac5a8a1
#owner: https://api.github.com/users/yh5050

#!/usr/bin/env python
# -*- encoding: utf-8 -*-

# USAGE:
#   python lab1_part1.py music_small.db

import sys
SELECT ...
PRAGMA table_info(track);



# The database file should be given as the first argument on the command line
# Please do not hard code the database file!
db_file = sys.argv[1]

# We connect to the database using 
with sqlite3.connect(db_file) as conn:
    # This query counts the number of artists who became active in 1990
    year = (1990,)
    for row in conn.execute('SELECT count(*) FROM artist WHERE artist_active_year_begin=?', year):
        # Since there is no grouping here, the aggregation is over all rows
        # and there will only be one output row from the query, which we can
        # print as follows:
        print('Tracks from {}: {}'.format(year[0], row[0]))
        
        # The [0] bits here tell us to pull the first column out of the 'year' tuple
        # and query results, respectively.

    # ADD YOUR CODE STARTING HERE
        def show_cols(table):
        cols = [r[1] for r in conn.execute(f"PRAGMA table_info({table});").fetchall()]
        print(f"{table} columns:", cols)

    # Uncomment these 3 lines ONCE to discover schema, then comment them back.
    # show_cols("track")
    # show_cols("artist")
    # show_cols("album")

    # Question 1
    print('Question 1:')
        # Which tracks (ids and names) have a lyricist whose name begins with "W"?

    # implement your solution to q1
    
    q1 = f"""
    SELECT {TRACK_ID}, {TRACK_TITLE}
    FROM track
    WHERE {TRACK_LYRICIST} LIKE 'W%'
    """
    for row in conn.execute(q1):
        print(row)

    
    # Question 2
    print('Question 2:')
        # What are the values that can be taken by the track.track_explicit field?


    # implement your solution to q2
    
   q2 = """
    SELECT DISTINCT track_explicit
    FROM track
    """
    for row in conn.execute(q2):
        print(row)
    
    # Question 3
    print('Question 3:')
        # Which track (id and title) has the most listens?
    # implement your solution to q3
       q3 = f"""
    SELECT {TRACK_ID}, {TRACK_TITLE}
    FROM track
    ORDER BY {TRACK_LISTENS} DESC
    LIMIT 1
    """
    for row in conn.execute(q3):
        print(row)


    
    # Question 4
    print('Question 4:')
          # How many artists have "related projects"?
    # implement your solution to q4
    q4 = f"""
    SELECT COUNT(*)
    FROM artist
    WHERE {ARTIST_RELATED_PROJECTS} IS NOT NULL
    """
    for row in conn.execute(q4):
        print(row)


    # Question 5
    print('Question 5:')
      # Which non-null language codes have exactly 4 tracks?  
    # implement your solution to q5
	
    q5 = f"""
    SELECT {TRACK_LANGUAGE_CODE}
    FROM track
    WHERE {TRACK_LANGUAGE_CODE} IS NOT NULL
    GROUP BY {TRACK_LANGUAGE_CODE}
    HAVING COUNT(*) = 4
    """
    for row in conn.execute(q5):
        print(row)


    
    # Question 6
    print('Question 6:')
     # How many tracks are by artists known to be active only within the 1990s?

    # implement your solution to q6
    
 q6 = f"""
    SELECT COUNT(*)
    FROM track t
    JOIN artist a
      ON t.{TRACK_ARTIST_FK} = a.{ARTIST_PK}
    WHERE a.{ARTIST_ACTIVE_BEGIN} >= 1990
      AND a.{ARTIST_ACTIVE_END} <= 1999
    """
    for row in conn.execute(q6):
        print(row)
    
    # Question 7
    print('Question 7:')
         # Which three artists have worked with the largest number of distinct album producers?
    # implement your solution to q7
    q7 = f"""
    SELECT a.{ARTIST_NAME}, COUNT(DISTINCT al.{ALBUM_PRODUCER}) AS n_prod
    FROM artist a
    JOIN album al
      ON al.{ALBUM_ARTIST_FK} = a.{ARTIST_PK}
    GROUP BY a.{ARTIST_PK}
    ORDER BY n_prod DESC
    LIMIT 3
    """
    for row in conn.execute(q7):
        print(row)
    
    # Question 8
    print('Question 8:')
     # Which track has the largest difference (album_listens - track_listens)?
	 
    # implement your solution to q8
    
    q8 = f"""
    SELECT t.{TRACK_ID}, t.{TRACK_TITLE}, a.{ARTIST_NAME},
           (al.{ALBUM_LISTENS} - t.{TRACK_LISTENS}) AS diff
    FROM track t
    JOIN album al
      ON t.{TRACK_ALBUM_FK} = al.{ALBUM_PK}
    JOIN artist a
      ON t.{TRACK_ARTIST_FK} = a.{ARTIST_PK}
    WHERE al.{ALBUM_LISTENS} IS NOT NULL
      AND t.{TRACK_LISTENS} IS NOT NULL
    ORDER BY diff DESC
    LIMIT 1
    """
    for row in conn.execute(q8):
        print(row)
 show_cols("track")
show_cols("artist")
show_cols("album")
