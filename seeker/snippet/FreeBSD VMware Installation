#date: 2025-08-18T17:12:31Z
#url: https://api.github.com/gists/5f56ba848c766328e63fecaa71e1051e
#owner: https://api.github.com/users/apotukar

#!/bin/sh
#
# Post-Install Setup für GhostBSD in VMware
# (System aktualisieren, open-vm-tools installieren & aktivieren,
# Grafiktreiber für VMware laden, Xorg-Konfiguration setzen)

# --- 1. System aktualisieren ---
# Paketdatenbank aktualisieren und alle installierten Pakete upgraden
sudo pkg update
sudo pkg upgrade -y

# --- 2. VMware-Tools installieren ---
# Enthält Maus-Integration, Copy&Paste, Shared Folders, Autoresize usw.
sudo pkg install -y open-vm-tools open-vm-tools-nox11

# --- 3. VMware-Tools Dienste beim Booten aktivieren ---
sudo sysrc vmware_guest_vmblock_enable="YES"
sudo sysrc vmware_guest_vmhgfs_enable="YES"
sudo sysrc vmware_guest_vmmemctl_enable="YES"
sudo sysrc vmware_guest_vmxnet_enable="YES"
sudo sysrc vmware_guestd_enable="YES"

# --- 4. VMware-Tools sofort starten (ohne Reboot) ---
sudo service vmware-guestd start

# --- 5. Xorg-Treiber für VMware installieren ---
# Dadurch funktioniert Autoresize und bessere Grafik
sudo pkg install -y xf86-video-vmware xorg-drivers

# --- 6. Xorg-Konfiguration für VMware anlegen ---
# Erzwingt die Nutzung des VMware-Treibers statt scfb/vesa
sudo mkdir -p /usr/local/etc/X11/xorg.conf.d
cat << 'EOF' | sudo tee /usr/local/etc/X11/xorg.conf.d/driver-vmware.conf
Section "Device"
    Identifier "Card0"
    Driver "vmware"
EndSection
EOF

# --- Hinweis ---
# Danach bitte neustarten:
#   sudo reboot
#
# Nach dem Reboot sollten:
#  - Bildschirmauflösung automatisch an Fenstergröße angepasst werden
#  - Copy & Paste mit dem Host funktionieren
#  - /mnt/hgfs für Shared Folders verfügbar sein
