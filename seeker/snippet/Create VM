#date: 2022-02-09T17:02:22Z
#url: https://api.github.com/gists/0273f3c8f8e3b8a5a3b1a7cfc1997902
#owner: https://api.github.com/users/sbourg-zenoss

#!/usr/bin/env bash

MACHINE_NAME="_$(date +"%Y.%m.%d")_16_ubuntu_server"
  
VBoxManage createvm --name $MACHINE_NAME --ostype "Ubuntu_64" --register --basefolder "$(pwd)"
VBoxManage modifyvm $MACHINE_NAME --ioapic on                     
VBoxManage modifyvm $MACHINE_NAME --memory 8192 --vram 128       
VBoxManage modifyvm $MACHINE_NAME --cpus 4   
VBoxManage modifyvm $MACHINE_NAME --nic1 nat
VBoxManage modifyvm $MACHINE_NAME --graphicscontroller vmsvga

# Create drive folder.
MACHINE_MEDIA_PATH="$(pwd)/${MACHINE_NAME}/media"
mkdir MACHINE_MEDIA_PATH

# Create primary drive: /dev/sda 50GB
VBoxManage createhd --filename "${MACHINE_MEDIA_PATH}/sda.vdi" --size 50000 --format VDI                     
VBoxManage storagectl $MACHINE_NAME --name "SATA Controller" --add sata --controller IntelAhci       
VBoxManage storageattach $MACHINE_NAME --storagectl "SATA Controller" --port 0 --device 0 --type hdd --medium  "${MACHINE_MEDIA_PATH}/sda.vdi"              

# Create secondary drive: /dev/sdb 100GB
VBoxManage createhd --filename "${MACHINE_MEDIA_PATH}/sdb.vdi" --size 100000 --format VDI                     
VBoxManage storagectl $MACHINE_NAME --name "SATA Controller" --add sata --controller IntelAhci       
VBoxManage storageattach $MACHINE_NAME --storagectl "SATA Controller" --port 1 --device 0 --type hdd --medium  "${MACHINE_MEDIA_PATH}/sdb.vdi"             

# Download and mount install media
wget --directory "${MACHINE_MEDIA_PATH}" https://releases.ubuntu.com/16.04/ubuntu-16.04.7-server-amd64.iso
VBoxManage storagectl $MACHINE_NAME --name "IDE Controller" --add ide --controller PIIX4       
VBoxManage storageattach $MACHINE_NAME --storagectl "IDE Controller" --port 1 --device 0 --type dvddrive --medium "${MACHINE_MEDIA_PATH}/ubuntu-16.04.7-server-amd64.iso"
VBoxManage modifyvm $MACHINE_NAME --boot1 dvd --boot2 disk --boot3 none --boot4 none 
VBoxManage startvm $MACHINE_NAME
