#date: 2025-03-31T16:47:04Z
#url: https://api.github.com/gists/e5d2af7fc44c890b3e43a80c9881fcff
#owner: https://api.github.com/users/tbutterf

#!/bin/bash

###
### Usage: `ddev create-alias <subsite1>`
### Example: `ddev create-alias admissionasu`

set -eu -o pipefail

function show_help() {
  sed -n 's/^###//p' ${0}
}

while :; do
  case ${1:-} in
  -h | -\? | --help)
    show_help
    exit
    ;;
  --) # End of all options.
    shift
    break
    ;;
  -?*)
    printf 'WARN: Unknown option (ignored): %s\n' "$1" >&2
    ;;
  *) # Default case: No more options, so break out of the loop.
    break ;;
  esac

  shift
done

function create_subsite_alias() {
  site_name=$1
  # Create the drush/sites directory if it doesn't exist
  mkdir -p drush/sites
  # Write/overwrite the drush/sites/${site_name}.site.yml file
  # Could make this more dynamic by pulling remote environ details via
  # `acli remote:aliases:list` but these are not likely to change often.
  cat <<EOF > drush/sites/${site_name}.site.yml
# Alias added by acquia-pull
# Local DDEV site
local:
  root: /app/docroot
  uri: 'https://${site_name}.asu.ddev.site/'
# ${site_name} Site Factory environments
live:
  root: /var/www/html/asufactory1.01live/docroot
  uri: 'https://${site_name}.asufactory1.acsitefactory.com/'
test:
  root: /var/www/html/asufactory1.01test/docroot
  uri: 'https://test-${site_name}.asufactory1.acsitefactory.com/'
dev:
  root: /var/www/html/asufactory1.01dev/docroot
  uri: 'https://dev-${site_name}.asufactory1.acsitefactory.com/'
EOF
}

if [ $# -eq 0 ]; then
  show_help
  exit 1
fi

create_subsite_alias $1
